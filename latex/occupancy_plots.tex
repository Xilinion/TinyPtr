\section{Hash Function Occupancy Distribution Analysis}

\begin{figure}[p]
    \centering

    % Box plot style occupancy distribution
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=8cm,
                    height=7cm,
                    xlabel={Number of Balls per Bin},
                    ylabel={Probability (Log Scale)},
                    ymode=log,
                    ymin=1e-8,
                    ymax=1,
                    xmin=-0.5,
                    xmax=10.5,
                    grid=major,
                    grid style={gray!30},
                    legend pos=south west,
                    legend style={font=\small},
                    tick label style={font=\small},
                    label style={font=\small},
                    title={Experimental Distribution vs Theory},
                    title style={font=\small}
                ]

                % Plot experimental data as scatter points (10 repetitions)
                \addplot[
                    only marks,
                    mark=o,
                    mark size=2pt,
                    color=exp1,
                    opacity=0.8
                ] table[
                    x=occupancy,
                    y=exp_probability,
                    row filter/.code={\ifnum\pgfplotstablerow<12\else\pgfplotstableuserowfalse\fi}
                ] {\occupancydata};
                \addlegendentry{Experimental (10 runs)}

                % Plot smooth Poisson line (theoretical data from CSV)
                \addplot[
                    mark=none,
                    thick,
                    color=poisson,
                    smooth
                ] table[
                        x=occupancy,
                        y=exp_probability,
                        row filter/.code={\ifnum\pgfplotstablerow>11\else\pgfplotstableuserowfalse\fi}
                    ] {\occupancydata};
                \addlegendentry{Poisson Theory ($\lambda=1$)}

            \end{axis}
        \end{tikzpicture}
        \caption{Distribution Comparison (Log Scale)}
    \end{subfigure}
    \hfill
    % Linear scale for low occupancy values
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=8cm,
                    height=7cm,
                    xlabel={Number of Balls per Bin},
                    ylabel={Probability},
                    xmin=-0.5,
                    xmax=5.5,
                    ymin=0,
                    grid=major,
                    grid style={gray!30},
                    legend pos=south west,
                    legend style={font=\small},
                    tick label style={font=\small},
                    label style={font=\small},
                    title={Linear Scale (0-5 balls)},
                    title style={font=\small}
                ]

                % Plot experimental data for common values as scatter points
                \addplot[
                    only marks,
                    mark=o,
                    mark size=2pt,
                    color=exp1,
                    opacity=0.8
                ] table[
                    x=occupancy,
                    y=exp_probability,
                    row filter/.code={\ifnum\pgfplotstablerow<12\else\pgfplotstableuserowfalse\fi}
                ] {\occupancydata};
                \addlegendentry{Experimental (10 runs)}

                % Plot smooth Poisson line (theoretical data from CSV)
                \addplot[
                    mark=none,
                    thick,
                    color=poisson,
                    smooth
                ] table[
                        x=occupancy,
                        y=exp_probability,
                        restrict expr to domain={\thisrow{object_id}}{-1:-1},
                        restrict expr to domain={\thisrow{occupancy}}{0:5}
                    ] {\occupancydata};
                \addlegendentry{Poisson Theory ($\lambda=1$)}

            \end{axis}
        \end{tikzpicture}
        \caption{Common Values (Linear Scale)}
    \end{subfigure}

    \caption{Hash Function Occupancy Distribution Analysis. Left: Full distribution on logarithmic scale showing rare events. Right: Linear scale focusing on common occupancy values (0-5 balls). The theoretical Poisson distribution is calculated directly in LaTeX. All experimental runs are shown as individual points.}
    \label{fig:occupancy_analysis}
\end{figure} 