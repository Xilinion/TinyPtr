\section{Scaling Analysis}

% Function to map case numbers to descriptive names
\newcommand{\getCaseName}[1]{%
    \ifnum#1=1 Insertion\fi%
    \ifnum#1=3 Deletion\fi%
    \ifnum#1=6 Positive Query\fi%
    \ifnum#1=7 Negative Query\fi%
}

% Helper macro to plot all objects for a given case
\newcommand{\AddAllObjectPlotsForScaling}[1]{%
    % Cuckoo (object_id=6)
    \addplot[CuckooLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{6:6}
    ] {\scalingdata};
    
    % Iceberg (object_id=7)
    \addplot[IcebergLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{7:7}
    ] {\scalingdata};
    
    % Junction (object_id=15)
    \addplot[JunctionLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{15:15}
    ] {\scalingdata};
    
    % TPHT (object_id=17)
    \addplot[TPHTLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{17:17}
    ] {\scalingdata};
    
    % Blast (object_id=20)
    \addplot[BlastLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{20:20}
    ] {\scalingdata};
}

% Shared legend above all graphs
\begin{figure}[p]
    \centering
    \begin{tikzpicture}
        \begin{axis}[
                width=12cm,
                height=2cm,
                hide axis,
                legend entries={Cuckoo, Iceberg, Junction, TPHT, Blast},
                legend columns=5,
                legend style={font=\small, column sep=15pt, /tikz/every even column/.append style={column sep=15pt}},
                legend to name={scaling-legend}
            ]
            \addplot[CuckooLineStyle] coordinates {(0,0)};
            \addplot[IcebergLineStyle] coordinates {(0,0)};
            \addplot[JunctionLineStyle] coordinates {(0,0)};
            \addplot[TPHTLineStyle] coordinates {(0,0)};
            \addplot[BlastLineStyle] coordinates {(0,0)};
        \end{axis}
    \end{tikzpicture}
    \vspace{0.5cm}
\end{figure}

\begin{figure}[p]
    \centering
    
    % Display shared legend
    {\footnotesize \pgfplotslegendfromname{scaling-legend}}
    \vspace{0.3cm}

    % Case 1
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=6cm,
                    height=4cm,
                    xlabel={Thread Number},
                    ylabel={Throughput (M ops/s)},
                    xmode=log,
                    ymode=log,
                    log basis x=2,
                    log basis y=10,
                    xmin=0.5,
                    xmax=64,
                    ymin=0.1,
                    ymax=400,
                    xtick={1,2,4,8,16,32},
                    ytick={0.1,1,10,100},
                    grid=major,
                    grid style={gray!30},
                    tick label style={font=\small},
                    label style={font=\small},
                    title={\getCaseName{1}},
                    title style={font=\small},
                    scaled ticks=true,
                    tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
                ]

                \AddAllObjectPlotsForScaling{1}

            \end{axis}
        \end{tikzpicture}
        \caption{\getCaseName{1}}
    \end{subfigure}
    \hfill
    % Case 3
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=6cm,
                    height=4cm,
                    xlabel={Thread Number},
                    ylabel={Throughput (M ops/s)},
                    xmode=log,
                    ymode=log,
                    log basis x=2,
                    log basis y=10,
                    xmin=0.5,
                    xmax=64,
                    ymin=0.1,
                    ymax=400,
                    xtick={1,2,4,8,16,32},
                    ytick={0.1,1,10,100},
                    grid=major,
                    grid style={gray!30},
                    tick label style={font=\small},
                    label style={font=\small},
                    title={\getCaseName{3}},
                    title style={font=\small},
                    scaled ticks=true,
                    tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
                ]

                \AddAllObjectPlotsForScaling{3}

            \end{axis}
        \end{tikzpicture}
        \caption{\getCaseName{3}}
    \end{subfigure}

    % Case 6
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=6cm,
                    height=4cm,
                    xlabel={Thread Number},
                    ylabel={Throughput (M ops/s)},
                    xmode=log,
                    ymode=log,
                    log basis x=2,
                    log basis y=10,
                    xmin=0.5,
                    xmax=64,
                    ymin=0.1,
                    ymax=1000,
                    xtick={1,2,4,8,16,32},
                    ytick={0.1,1,10,100,1000},
                    grid=major,
                    grid style={gray!30},
                    tick label style={font=\small},
                    label style={font=\small},
                    title={\getCaseName{6}},
                    title style={font=\small},
                    scaled ticks=true,
                    tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
                ]

                \AddAllObjectPlotsForScaling{6}

            \end{axis}
        \end{tikzpicture}
        \caption{\getCaseName{6}}
    \end{subfigure}
    \hfill
    % Case 7
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=6cm,
                    height=4cm,
                    xlabel={Thread Number},
                    ylabel={Throughput (M ops/s)},
                    xmode=log,
                    ymode=log,
                    log basis x=2,
                    log basis y=10,
                    xmin=0.5,
                    xmax=64,
                    ymin=0.1,
                    ymax=1000,
                    xtick={1,2,4,8,16,32},
                    ytick={0.1,1,10,100,1000},
                    grid=major,
                    grid style={gray!30},
                    tick label style={font=\small},
                    label style={font=\small},
                    title={\getCaseName{7}},
                    title style={font=\small},
                    scaled ticks=true,
                    tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
                ]

                \AddAllObjectPlotsForScaling{7}

            \end{axis}
        \end{tikzpicture}
        \caption{\getCaseName{7}}
    \end{subfigure}

    \caption{Scaling Analysis for different hash table implementations across various operations. Each subfigure shows throughput scaling with thread count for a specific operation type.}
    \label{fig:scaling_analysis}
\end{figure}