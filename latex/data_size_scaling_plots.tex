\section{Data Size Scaling}

% Read the CSV produced by data_size_scaling_to_csv.py
\pgfplotstableread[col sep=comma]{../results/csv/data_size_scaling_results.csv}{\datasizedata}

% Helper to map case id to label
\newcommand{\getScalingCaseName}[1]{%
  \ifnum#1=1 Insertion\fi%
  \ifnum#1=3 Deletion\fi%
  \ifnum#1=6 Positive Query\fi%
  \ifnum#1=7 Negative Query\fi%
}

% Helper to add all 5 objects with consistent styles
\newcommand{\AddAllObjectsForDataSize}[1]{%
  % Cuckoo (6)
  \addplot[CuckooLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{6:6}
  ] {\datasizedata};
  % Iceberg (7)
  \addplot[IcebergLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{7:7}
  ] {\datasizedata};
  % Junction (15)
  \addplot[JunctionLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{15:15}
  ] {\datasizedata};
  % TPHT (17)
  \addplot[TPHTLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{17:17}
  ] {\datasizedata};
  % Blast (20)
  \addplot[BlastLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{20:20}
  ] {\datasizedata};
}

% Shared legend (reuse scaling legend styles)
\begin{figure}[p]
  \centering
  {\footnotesize \pgfplotslegendfromname{scaling-legend}}
  \vspace{0.3cm}

  % Case 1
  \begin{subfigure}[b]{0.48\textwidth}
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        width=6cm,
        height=4cm,
        xlabel={Table Size},
        ylabel={Throughput (M ops/s)},
        xmode=log,
        log basis x=2,
        xmin=2e4,
        xmax=2e8,
        grid=major,
        grid style={gray!30},
        tick label style={font=\small},
        label style={font=\small},
        title={\getScalingCaseName{1}},
        title style={font=\small},
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
      ]
      \AddAllObjectsForDataSize{1}
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{1}}
  \end{subfigure}
  \hfill

  % Case 3
  \begin{subfigure}[b]{0.48\textwidth}
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        width=6cm,
        height=4cm,
        xlabel={Table Size},
        ylabel={Throughput (M ops/s)},
        xmode=log,
        log basis x=2,
        xmin=2e4,
        xmax=2e8,
        grid=major,
        grid style={gray!30},
        tick label style={font=\small},
        label style={font=\small},
        title={\getScalingCaseName{3}},
        title style={font=\small},
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
      ]
      \AddAllObjectsForDataSize{3}
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{3}}
  \end{subfigure}

  % Case 6
  \begin{subfigure}[b]{0.48\textwidth}
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        width=6cm,
        height=4cm,
        xlabel={Table Size},
        ylabel={Throughput (M ops/s)},
        xmode=log,
        log basis x=2,
        xmin=2e4,
        xmax=2e8,
        grid=major,
        grid style={gray!30},
        tick label style={font=\small},
        label style={font=\small},
        title={\getScalingCaseName{6}},
        title style={font=\small},
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
      ]
      \AddAllObjectsForDataSize{6}
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{6}}
  \end{subfigure}
  \hfill

  % Case 7
  \begin{subfigure}[b]{0.48\textwidth}
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        width=6cm,
        height=4cm,
        xlabel={Table Size},
        ylabel={Throughput (M ops/s)},
        xmode=log,
        log basis x=2,
        xmin=2e4,
        xmax=2e8,
        grid=major,
        grid style={gray!30},
        tick label style={font=\small},
        label style={font=\small},
        title={\getScalingCaseName{7}},
        title style={font=\small},
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
      ]
      \AddAllObjectsForDataSize{7}
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{7}}
  \end{subfigure}

  \caption{Throughput vs Table Size (log-x) across operations. Styles match prior figures.}
  \label{fig:data_size_scaling}
\end{figure}


